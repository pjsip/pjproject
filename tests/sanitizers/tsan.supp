# Thread Sanitizer suppressions for PJSIP
# Add suppressions here if needed when TSan detects false positives
#
# Disable data race warnings as most are by design or harmless
# Focus on deadlock reports only (e.g., lock-order-inversion)
race:*

# Lock-order-inversion endpt_on_tx_msg ../src/pjsip/sip_endpoint.c with:
# - pjsip_tsx_layer_find_tsx ../src/pjsip/sip_transaction.c
# - pjsip_tsx_recv_msg ../src/pjsip/sip_transaction.c
# - rt_on_rx_response ../src/test/transport_test.c
deadlock:pthread_rwlock_rdlock

# Lock-order-inversion stateless_send_transport_cb ../src/pjsip/sip_util.c with:
# - pj_ioqueue_connect ../src/pj/ioqueue_common_abs.c
# - tp_state_callback ../src/pjsip/sip_transport.c
# - rt_on_rx_response ../src/test/transport_test.c
deadlock:stateless_send_transport_cb

# pjsip_dlg_on_tsx_state ../src/pjsip/sip_dialog.c
# - pjsip_tsx_set_transport ../src/pjsip/sip_transaction.c
# - pjsip_dlg_create_uas_and_inc_lock ../src/pjsip/sip_dialog.c
deadlock:pjsip_dlg_on_tsx_state

# Lock-order-inversion destroy_transport ../src/pjsip/sip_transport.c with:
# - udp_shutdown ../src/pjsip/sip_transport_udp.c
deadlock:destroy_transport

# Lock-order-inversion lis_destroy ../src/pjsip/sip_transport_tcp.c with:
# - pjsip_transport_register ../src/pjsip/sip_transport.c
deadlock:lis_destroy
